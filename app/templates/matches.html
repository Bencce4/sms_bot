{% extends "base.html" %}
{% block content %}
<h2>Preview & Filter</h2>

<form method="post" action="/admin/preview">
  <label>City</label>
  <select name="city">
    <option value="">All</option>
    {% for c in cities %}
      <option value="{{ c }}" {% if city_sel==c %}selected{% endif %}>{{ c }}</option>
    {% endfor %}
  </select>

  <label>Profession</label>
  <select name="prof">
    <option value="">All</option>
    {% for p in profs %}
      <option value="{{ p }}" {% if prof_sel==p %}selected{% endif %}>{{ p }}</option>
    {% endfor %}
  </select>

  <label>Limit</label>
  <input type="number" name="limit" min="1" max="1000" value="{{ limit }}" />
  <button type="submit">Preview</button>
</form>

<p>Total in filter: {{ total }}</p>

<table>
  <thead>
    <tr>
      <th>match_id</th>
      <th>Miestas</th>
      <th>Specialybė</th>
      <th>Tel. nr</th>
      <th>sms_text</th>
    </tr>
  </thead>
    <tbody>
    {% if rows and rows|length > 0 %}
        {% for m in rows %}
        <tr>
        <td>{{ m.match_id }}</td>
        <td>{{ m.Miestas }}</td>
        <td>{{ m.Specialybė }}</td>
        <td>{{ m["Tel. nr"] }}</td>
        <td>{{ m.sms_text }}</td>
        </tr>
        {% endfor %}
    {% else %}
        <tr>
        <td colspan="5" style="text-align:center; color:#666;">
            No matches found for the current data. Check city/profession or project “Aktualūs”.
        </td>
        </tr>
    {% endif %}
    </tbody>
</table>

<form method="post" action="/admin/send">
  <input type="hidden" name="city" value="{{ city_sel or '' }}">
  <input type="hidden" name="prof" value="{{ prof_sel or '' }}">
  <input type="hidden" name="limit" value="{{ limit }}">
<button type="submit" class="btn" {% if not rows or rows|length == 0 %}disabled{% endif %}>Send</button>
</form>
{% endblock %}
